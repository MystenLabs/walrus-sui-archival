syntax = "proto3";

package archival;

// CheckpointBlobInfo stores metadata about a blob containing checkpoints.
// Fields are optional to ensure backward compatibility - new fields can be added
// without breaking existing data.
message CheckpointBlobInfo {
  // Version of this message format for future compatibility.
  uint32 version = 1;

  // Blob identifier (32 bytes).
  bytes blob_id = 2;

  // Blob object ID (32 bytes).
  bytes object_id = 3;

  // First checkpoint number in this blob.
  uint64 start_checkpoint = 4;

  // Last checkpoint number in this blob (inclusive).
  uint64 end_checkpoint = 5;

  // Whether this blob contains the last transaction of the Sui epoch.
  bool end_of_epoch = 6;

  // Epoch when this blob will be expired.
  uint32 blob_expiration_epoch = 7;

  // Index entries mapping checkpoint numbers to their offset/length in the blob.
  repeated IndexEntry index_entries = 8;

  // Whether this blob has been wrapped as a SharedArchivalBlob.
  // If true, object_id stores the SharedArchivalBlob object ID.
  // If false, object_id stores the regular Blob object ID.
  bool is_shared_blob = 9;

  // Reserved fields for future use (100-199).
  // This allows adding new fields without breaking compatibility.
}

// IndexEntry represents a single checkpoint's location within a blob.
message IndexEntry {
  // Checkpoint sequence number.
  uint64 checkpoint_number = 1;

  // Offset in bytes from the start of the blob.
  uint64 offset = 2;

  // Length in bytes of this checkpoint data.
  uint64 length = 3;
}